<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="light dark">
  <title>Drupal Snippets Cheatsheet</title>
  <link rel="stylesheet" href="/assets/dist-main.css">
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap");
    body {
      font-family: "Inter", sans-serif;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-gray-100">
  <button onclick="toggleDark()" id="theme-toggle" class="px-4 py-2 border flex items-center gap-2 cursor-pointer fixed top-4 right-4 z-50 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-700 rounded-lg shadow-md hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
    <span id="icon-sun" style="display:none;">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="5"/>
        <g>
          <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </g>
      </svg>
    </span>
    <span id="icon-moon" style="display:none;">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/></svg>
    </span>
    <span class="sr-only">Toggle Theme</span>
  </button>
  <div class="container mx-auto px-4 py-8">
    <h1>Drupal Snippets Cheatsheet</h1>
    <h1 id="drupal-code-snippets-cheat-sheet">Drupal Code Snippets Cheat Sheet</h1>
<h2 id="index">Index</h2>

<ul>
  <li><a href="#routing-and-controllers">Routing and Controllers</a></li>
  <li><a href="#services-and-dependency-injection">Services and Dependency Injection</a></li>
  <li><a href="#plugins">Plugins</a></li>
  <li><a href="#event-subscribers">Event Subscribers</a></li>
  <li><a href="#custom-permissions">Custom Permissions</a></li>
  <li><a href="#form-alter">Form Alter</a></li>
  <li><a href="#entity-query">Entity Query</a></li>
  <li><a href="#menu-link">Menu Link</a></li>
  <li><a href="#custom-field-type">Custom Field Type</a></li>
  <li><a href="#custom-field-formatter">Custom Field Formatter</a></li>
  <li><a href="#custom-access-handler">Custom Access Handler</a></li>
  <li><a href="#sending-email">Sending Email</a></li>
  <li><a href="#caching-snippet">Caching Snippet</a></li>
  <li><a href="#create-a-node-programmatically">Create a node programmatically</a></li>
  <li><a href="#add-a-custom-field-programmatically">Add a custom field programmatically</a></li>
</ul>

<hr />

<h2 id="routing-and-controllers">Routing and Controllers</h2>

<p><strong>Routing YAML</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">my_module.my_route</span><span class="pi">:</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/custom/path'</span>
  <span class="na">defaults</span><span class="pi">:</span>
    <span class="na">_controller</span><span class="pi">:</span> <span class="s1">'</span><span class="s">\Drupal\my_module\Controller\MyController::myMethod'</span>
    <span class="na">_title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">My</span><span class="nv"> </span><span class="s">Page</span><span class="nv"> </span><span class="s">Title'</span>
  <span class="na">requirements</span><span class="pi">:</span>
    <span class="na">_permission</span><span class="pi">:</span> <span class="s1">'</span><span class="s">access</span><span class="nv"> </span><span class="s">content'</span>
</code></pre></div></div>

<p><strong>Basic Controller</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Controller</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Controller\ControllerBase</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">MyController</span> <span class="kd">extends</span> <span class="nc">ControllerBase</span> <span class="p">{</span>
  <span class="na">#[Route('/custom/path', name: 'my_route')]</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">myMethod</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
      <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">),</span>
    <span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Via <strong>attributes</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Controller</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Controller\ControllerBase</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">MyController</span> <span class="kd">extends</span> <span class="nc">ControllerBase</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">myMethod</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
      <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">),</span>
    <span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="services-and-dependency-injection">Services and Dependency Injection</h2>

<p><strong>Define a service</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">my_module.my_service</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">Drupal\my_module\Service\MyService</span>
    <span class="na">arguments</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">@entity_type.manager'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">@logger.channel.my_module'</span><span class="pi">]</span>
</code></pre></div></div>

<p><strong>Basic Service Class</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Service</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Entity\EntityTypeManagerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Log\LoggerInterface</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">MyService</span> <span class="p">{</span>
  <span class="k">protected</span> <span class="nv">$entityTypeManager</span><span class="p">;</span>
  <span class="k">protected</span> <span class="nv">$logger</span><span class="p">;</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="kt">EntityTypeManagerInterface</span> <span class="nv">$entityTypeManager</span><span class="p">,</span> <span class="kt">LoggerInterface</span> <span class="nv">$logger</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entityTypeManager</span> <span class="o">=</span> <span class="nv">$entityTypeManager</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logger</span> <span class="o">=</span> <span class="nv">$logger</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">doSomething</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logger</span><span class="o">-&gt;</span><span class="nf">info</span><span class="p">(</span><span class="s1">'Doing something'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>via <strong>attributes</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Service</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Entity\EntityTypeManagerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Log\LoggerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\DependencyInjection\Attribute\Autowire</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\DependencyInjection\Attribute\AsService</span><span class="p">;</span>

<span class="na">#[AsService(id: 'my_module.my_service')]</span>
<span class="kd">class</span> <span class="nc">MyService</span> <span class="p">{</span>
  <span class="k">protected</span> <span class="nv">$entityTypeManager</span><span class="p">;</span>
  <span class="k">protected</span> <span class="nv">$logger</span><span class="p">;</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span>
    <span class="kt">EntityTypeManagerInterface</span> <span class="nv">$entityTypeManager</span><span class="p">,</span>
    <span class="na">#[Autowire(service:'logger.channel.my_module')]</span>
    <span class="nc">LoggerInterface</span> <span class="nv">$logger</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entityTypeManager</span> <span class="o">=</span> <span class="nv">$entityTypeManager</span><span class="p">;</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logger</span> <span class="o">=</span> <span class="nv">$logger</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">doSomething</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logger</span><span class="o">-&gt;</span><span class="nf">info</span><span class="p">(</span><span class="s1">'Doing something'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Controller Injection</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Controller</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Controller\ControllerBase</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\DependencyInjection\ContainerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nf">Drupal\my_module</span><span class="nc">\Service\MyService</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CustomPageController</span> <span class="kd">extends</span> <span class="nc">ControllerBase</span> <span class="p">{</span>
  <span class="k">protected</span> <span class="nv">$myService</span><span class="p">;</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="kt">CustomService</span> <span class="nv">$myService</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">myService</span> <span class="o">=</span> <span class="nv">$myService</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">create</span><span class="p">(</span><span class="kt">ContainerInterface</span> <span class="nv">$container</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">static</span><span class="p">(</span>
      <span class="nv">$container</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'my_module.my_service'</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">content</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">myService</span><span class="o">-&gt;</span><span class="nf">doSomething</span><span class="p">();</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="plugins">Plugins</h2>

<p><strong>Basic Plugin (e.g. Block)</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Plugin\Block</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Block\BlockBase</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Entity\EntityTypeManagerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\DependencyInjection\ContainerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Plugin\ContainerFactoryPluginInterface</span><span class="p">;</span>

<span class="cd">/**
 * @Block(
 *   id = "latest_articles_block",
 *   admin_label = @Translation("Latest Articles Block")
 * )
 */</span>
<span class="kd">class</span> <span class="nc">LatestArticlesBlock</span> <span class="kd">extends</span> <span class="nc">BlockBase</span> <span class="kd">implements</span> <span class="nc">ContainerFactoryPluginInterface</span> <span class="p">{</span>
  <span class="k">protected</span> <span class="nv">$entityTypeManager</span><span class="p">;</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="kt">array</span> <span class="nv">$configuration</span><span class="p">,</span> <span class="nv">$plugin_id</span><span class="p">,</span> <span class="nv">$plugin_definition</span><span class="p">,</span> <span class="kt">EntityTypeManagerInterface</span> <span class="nv">$entity_type_manager</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">parent</span><span class="o">::</span><span class="nf">__construct</span><span class="p">(</span><span class="nv">$configuration</span><span class="p">,</span> <span class="nv">$plugin_id</span><span class="p">,</span> <span class="nv">$plugin_definition</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entityTypeManager</span> <span class="o">=</span> <span class="nv">$entity_type_manager</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">create</span><span class="p">(</span><span class="kt">ContainerInterface</span> <span class="nv">$container</span><span class="p">,</span> <span class="kt">array</span> <span class="nv">$configuration</span><span class="p">,</span> <span class="nv">$plugin_id</span><span class="p">,</span> <span class="nv">$plugin_definition</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">static</span><span class="p">(</span>
      <span class="nv">$configuration</span><span class="p">,</span>
      <span class="nv">$plugin_id</span><span class="p">,</span>
      <span class="nv">$plugin_definition</span><span class="p">,</span>
      <span class="nv">$container</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'entity_type.manager'</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">build</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$storage</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">entityTypeManager</span><span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'node'</span><span class="p">);</span>
    <span class="nv">$nodes</span> <span class="o">=</span> <span class="nv">$storage</span><span class="o">-&gt;</span><span class="nf">loadByProperties</span><span class="p">([</span>
      <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'article'</span><span class="p">,</span>
      <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">]);</span>
    <span class="nv">$latest_nodes</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$nodes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

    <span class="nv">$items</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$latest_nodes</span> <span class="k">as</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$items</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">toLink</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">[</span>
      <span class="s1">'#theme'</span> <span class="o">=&gt;</span> <span class="s1">'item_list'</span><span class="p">,</span>
      <span class="s1">'#items'</span> <span class="o">=&gt;</span> <span class="nv">$items</span><span class="p">,</span>
    <span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="event-subscribers">Event Subscribers</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\EventSubscriber</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Symfony\Component\EventDispatcher\EventSubscriberInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\HttpKernel\KernelEvents</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\HttpKernel\Event\ResponseEvent</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">MyEventSubscriber</span> <span class="kd">implements</span> <span class="nc">EventSubscriberInterface</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">getSubscribedEvents</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
      <span class="nc">KernelEvents</span><span class="o">::</span><span class="no">RESPONSE</span> <span class="o">=&gt;</span> <span class="s1">'onResponse'</span><span class="p">,</span>
    <span class="p">];</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">onResponse</span><span class="p">(</span><span class="kt">ResponseEvent</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="nf">getResponse</span><span class="p">();</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="n">headers</span><span class="o">-&gt;</span><span class="nf">set</span><span class="p">(</span><span class="s1">'X-Custom-Header'</span><span class="p">,</span> <span class="s1">'Value'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Event Subscriber registration</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">my_module.event_subscriber</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">Drupal\my_module\EventSubscriber\MyEventSubscriber</span>
    <span class="na">tags</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="pi">{</span> <span class="nv">name</span><span class="pi">:</span> <span class="nv">event_subscriber</span> <span class="pi">}</span>
</code></pre></div></div>

<p>via <strong>attributes</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Symfony\Component\EventDispatcher\Attribute\AsEventListener</span><span class="p">;</span>

<span class="na">#[AsEventListener(event: 'kernel.request', priority: 10)]</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">handleRequestEvent</span><span class="p">(</span><span class="kt">RequestEvent</span> <span class="nv">$event</span><span class="p">):</span> <span class="kt">void</span>
<span class="p">{</span>
    <span class="c1">// Logic before controller is called</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="custom-permissions">Custom Permissions</h2>

<p><strong>permissions.yml</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">my_module.custom_permission</span><span class="pi">:</span>
  <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">My</span><span class="nv"> </span><span class="s">Custom</span><span class="nv"> </span><span class="s">Permission'</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Allows</span><span class="nv"> </span><span class="s">users</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">something</span><span class="nv"> </span><span class="s">special.'</span>
</code></pre></div></div>

<p><strong>Usage in Routing</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">requirements</span><span class="pi">:</span>
  <span class="na">_permission</span><span class="pi">:</span> <span class="s1">'</span><span class="s">my_module.custom_permission'</span>
</code></pre></div></div>

<hr />

<h2 id="form-alter">Form Alter</h2>

<p><strong>via hook</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">my_module_form_alter</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="nc">\Drupal\Core\Form\FormStateInterface</span> <span class="nv">$form_state</span><span class="p">,</span> <span class="nv">$form_id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$form_id</span> <span class="o">===</span> <span class="s1">'user_register_form'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$form</span><span class="p">[</span><span class="s1">'my_custom_field'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span>
      <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'My Custom Field'</span><span class="p">),</span>
    <span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>via attributes</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\mymodule\Hook</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Form\FormStateInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Hook\Attribute\Hook</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">FormHooks</span> <span class="p">{</span>

  <span class="na">#[Hook('form_alter')]</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">alterForm</span><span class="p">(</span><span class="kt">array</span> <span class="o">&amp;</span><span class="nv">$form</span><span class="p">,</span> <span class="kt">FormStateInterface</span> <span class="nv">$form_state</span><span class="p">,</span> <span class="nv">$form_id</span><span class="p">):</span> <span class="kt">void</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$form_id</span> <span class="o">===</span> <span class="s1">'user_register_form'</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$form</span><span class="p">[</span><span class="s1">'my_custom_field'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'#type'</span> <span class="o">=&gt;</span> <span class="s1">'textfield'</span><span class="p">,</span>
        <span class="s1">'#title'</span> <span class="o">=&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'My Custom Field'</span><span class="p">),</span>
      <span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="entity-query">Entity Query</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$nodes</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">entityTypeManager</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">getStorage</span><span class="p">(</span><span class="s1">'node'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">getQuery</span><span class="p">()</span>
  <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'article'</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">condition</span><span class="p">(</span><span class="s1">'status'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>

<span class="nv">$loaded_nodes</span> <span class="o">=</span> <span class="nc">\Drupal\node\Entity\Node</span><span class="o">::</span><span class="nf">loadMultiple</span><span class="p">(</span><span class="nv">$nodes</span><span class="p">);</span>
</code></pre></div></div>

<hr />

<h2 id="menu-link">Menu Link</h2>

<p><strong>my_module.links.menu.yml</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">my_module.custom_link</span><span class="pi">:</span>
  <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">My</span><span class="nv"> </span><span class="s">Link'</span>
  <span class="na">route_name</span><span class="pi">:</span> <span class="s">my_module.my_route</span>
  <span class="na">parent</span><span class="pi">:</span> <span class="s">main-menu</span>
  <span class="na">weight</span><span class="pi">:</span> <span class="m">5</span>
</code></pre></div></div>

<hr />

<h2 id="custom-field-type">Custom Field Type</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Plugin\Field\FieldType</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Field\FieldItemBase</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Field\FieldStorageDefinitionInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\TypedData\DataDefinition</span><span class="p">;</span>

<span class="cd">/**
 * Defines a 'example_field' field type.
 *
 * @FieldType(
 *   id = "example_field",
 *   label = @Translation("Example Field"),
 *   description = @Translation("An example field implementation."),
 *   default_widget = "string_textfield",
 *   default_formatter = "string"
 * )
 */</span>
<span class="kd">class</span> <span class="nc">ExampleFieldItem</span> <span class="kd">extends</span> <span class="nc">FieldItemBase</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">propertyDefinitions</span><span class="p">(</span><span class="kt">FieldStorageDefinitionInterface</span> <span class="nv">$field_definition</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$properties</span><span class="p">[</span><span class="s1">'value'</span><span class="p">]</span> <span class="o">=</span> <span class="nc">DataDefinition</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'string'</span><span class="p">)</span>
      <span class="o">-&gt;</span><span class="nf">setLabel</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="s1">'Value'</span><span class="p">));</span>
    <span class="k">return</span> <span class="nv">$properties</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">isEmpty</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">getValue</span><span class="p">();</span>
    <span class="k">return</span> <span class="nv">$value</span> <span class="o">===</span> <span class="kc">NULL</span> <span class="o">||</span> <span class="nv">$value</span> <span class="o">===</span> <span class="s1">''</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">---</span>

<span class="c1">## Custom Field Formatter</span>

<span class="sb">``</span><span class="err">`</span><span class="n">php</span>
<span class="kn">namespace</span> <span class="nn">Drupal\my_module\Plugin\Field\FieldFormatter</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Field\FieldItemListInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Field\FormatterBase</span><span class="p">;</span>

<span class="cd">/**
 * @FieldFormatter(
 *   id = "my_custom_formatter",
 *   label = @Translation("My Custom Formatter"),
 *   field_types = {"string"}
 * )
 */</span>
<span class="kd">class</span> <span class="nc">MyCustomFormatter</span> <span class="kd">extends</span> <span class="nc">FormatterBase</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">viewElements</span><span class="p">(</span><span class="kt">FieldItemListInterface</span> <span class="nv">$items</span><span class="p">,</span> <span class="nv">$langcode</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$elements</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$items</span> <span class="k">as</span> <span class="nv">$delta</span> <span class="o">=&gt;</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$elements</span><span class="p">[</span><span class="nv">$delta</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="s1">'&lt;strong&gt;'</span> <span class="mf">.</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="n">value</span> <span class="mf">.</span> <span class="s1">'&lt;/strong&gt;'</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$elements</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<hr />

<h2 id="custom-access-handler">Custom Access Handler</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\node\NodeAccessControlHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Session\AccountInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Access\AccessResult</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CustomNodeAccessHandler</span> <span class="kd">extends</span> <span class="nc">NodeAccessControlHandler</span> <span class="p">{</span>
  <span class="k">protected</span> <span class="k">function</span> <span class="n">checkAccess</span><span class="p">(</span><span class="nv">$entity</span><span class="p">,</span> <span class="nv">$operation</span><span class="p">,</span> <span class="kt">AccountInterface</span> <span class="nv">$account</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$operation</span> <span class="o">===</span> <span class="s1">'delete'</span> <span class="o">&amp;&amp;</span> <span class="nv">$entity</span><span class="o">-&gt;</span><span class="nf">bundle</span><span class="p">()</span> <span class="o">===</span> <span class="s1">'article'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$account</span><span class="o">-&gt;</span><span class="nf">hasPermission</span><span class="p">(</span><span class="s1">'delete articles'</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nc">AccessResult</span><span class="o">::</span><span class="nf">forbidden</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="nf">checkAccess</span><span class="p">(</span><span class="nv">$entity</span><span class="p">,</span> <span class="nv">$operation</span><span class="p">,</span> <span class="nv">$account</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Override access control via services</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">entity_access.node</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">Drupal\my_module\CustomNodeAccessHandler</span>
    <span class="na">arguments</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">@entity_type.manager'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">@module_handler'</span><span class="pi">]</span>
</code></pre></div></div>
<hr />

<h2 id="custom-plugin-manager">Custom Plugin Manager</h2>

<p><strong>Define the Plugin Manager:</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Plugin</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Component\Plugin\PluginManagerInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Plugin\DefaultPluginManager</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CustomPluginManager</span> <span class="kd">extends</span> <span class="nc">DefaultPluginManager</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nc">\Traversable</span> <span class="nv">$namespaces</span><span class="p">,</span> <span class="nc">\Drupal\Core\Cache\CacheBackendInterface</span> <span class="nv">$cache_backend</span><span class="p">,</span> <span class="nc">\Drupal\Core\Extension\ModuleHandlerInterface</span> <span class="nv">$module_handler</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">parent</span><span class="o">::</span><span class="nf">__construct</span><span class="p">(</span>
      <span class="s1">'Plugin/CustomPlugin'</span><span class="p">,</span>
      <span class="nv">$namespaces</span><span class="p">,</span>
      <span class="nv">$module_handler</span><span class="p">,</span>
      <span class="s1">'Drupal\my_module\Plugin\CustomPluginInterface'</span><span class="p">,</span>
      <span class="s1">'Drupal\my_module\Annotation\CustomPlugin'</span>
    <span class="p">);</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">alterInfo</span><span class="p">(</span><span class="s1">'custom_plugin_info'</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setCacheBackend</span><span class="p">(</span><span class="nv">$cache_backend</span><span class="p">,</span> <span class="s1">'custom_plugins'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Define the Plugin Interface:</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Plugin</span><span class="p">;</span>

<span class="kd">interface</span> <span class="nc">CustomPluginInterface</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">process</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Define the Plugin Annotation:</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Annotation</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Component\Annotation\Plugin</span><span class="p">;</span>

<span class="cd">/**
 * Defines a Custom plugin annotation.
 *
 * @Annotation
 */</span>
<span class="kd">class</span> <span class="nc">CustomPlugin</span> <span class="kd">extends</span> <span class="nc">Plugin</span> <span class="p">{</span>
  <span class="k">public</span> <span class="nv">$id</span><span class="p">;</span>
  <span class="k">public</span> <span class="nv">$label</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Example Implementation</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Plugin\CustomPlugin</span><span class="p">;</span>

<span class="kn">use</span> <span class="nf">Drupal\my_module</span><span class="nc">\Plugin\CustomPluginInterface</span><span class="p">;</span>

<span class="cd">/**
 * @CustomPluginExample(
 *   id = "custom_plugin_example",
 *   label = @Translation("Custom Plugin Example")
 * )
 */</span>
<span class="kd">class</span> <span class="nc">CustomPluginExample</span> <span class="kd">implements</span> <span class="nc">CustomPluginInterface</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">process</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do something...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<hr />

<h2 id="sending-email">Sending Email</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$mailManager</span> <span class="o">=</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">service</span><span class="p">(</span><span class="s1">'plugin.manager.mail'</span><span class="p">);</span>
<span class="nv">$params</span><span class="p">[</span><span class="s1">'subject'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Test email'</span><span class="p">;</span>
<span class="nv">$params</span><span class="p">[</span><span class="s1">'message'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Hello from Drupal!'</span><span class="p">;</span>
<span class="nv">$mailManager</span><span class="o">-&gt;</span><span class="nb">mail</span><span class="p">(</span><span class="s1">'my_module'</span><span class="p">,</span> <span class="s1">'custom_mail'</span><span class="p">,</span> <span class="s1">'example@example.com'</span><span class="p">,</span> <span class="nc">\Drupal</span><span class="o">::</span><span class="nf">currentUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getPreferredLangcode</span><span class="p">(),</span> <span class="nv">$params</span><span class="p">);</span>
</code></pre></div></div>

<hr />

<h2 id="caching-snippet">Caching Snippet</h2>

<p><strong>Cacheable Metadata</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\Core\Cache\CacheableMetadata</span><span class="p">;</span>

<span class="nv">$build</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'#markup'</span> <span class="o">=&gt;</span> <span class="s1">'Hello World'</span><span class="p">,</span>
<span class="p">];</span>

<span class="nv">$cache_metadata</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CacheableMetadata</span><span class="p">();</span>
<span class="nv">$cache_metadata</span><span class="o">-&gt;</span><span class="nf">addCacheTags</span><span class="p">([</span><span class="s1">'node_list'</span><span class="p">]);</span>
<span class="nv">$cache_metadata</span><span class="o">-&gt;</span><span class="nf">applyTo</span><span class="p">(</span><span class="nv">$build</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>Cache Context</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Cache</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\Core\Cache\CacheContextInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\Core\Session\AccountProxyInterface</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">UserRoleCacheContext</span> <span class="kd">implements</span> <span class="nc">CacheContextInterface</span> <span class="p">{</span>
  <span class="k">protected</span> <span class="nv">$currentUser</span><span class="p">;</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="kt">AccountProxyInterface</span> <span class="nv">$current_user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">currentUser</span> <span class="o">=</span> <span class="nv">$current_user</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">getLabel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">t</span><span class="p">(</span><span class="s1">'User role'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">getContext</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$roles</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">currentUser</span><span class="o">-&gt;</span><span class="nf">getRoles</span><span class="p">();</span>
    <span class="nb">sort</span><span class="p">(</span><span class="nv">$roles</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="nv">$roles</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">function</span> <span class="n">getCacheableMetadata</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Cache Context registration</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">my_module.user_role_cache_context</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">Drupal\my_module\Cache\UserRoleCacheContext</span>
    <span class="na">arguments</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">@current_user'</span><span class="pi">]</span>
    <span class="na">tags</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="pi">{</span> <span class="nv">name</span><span class="pi">:</span> <span class="nv">cache.context</span><span class="pi">,</span> <span class="nv">id</span><span class="pi">:</span> <span class="s1">'</span><span class="s">user_role'</span> <span class="pi">}</span>
</code></pre></div></div>

<hr />

<h3 id="custom-rest-endpoint">Custom REST endpoint</h3>

<ul>
  <li>Given <strong>RESTful Web Services</strong> module is enabled</li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">namespace</span> <span class="nn">Drupal\my_module\Plugin\rest\resource</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Drupal\rest\Plugin\ResourceBase</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="cd">/**
 * Provides a custom REST resource.
 *
 * @RestResource(
 *   id = "custom_rest_resource",
 *   label = @Translation("Custom REST Resource"),
 *   uri_paths = {
 *     "canonical" = "/api/custom-resource"
 *   }
 * )
 */</span>
<span class="kd">class</span> <span class="nc">CustomRestResource</span> <span class="kd">extends</span> <span class="nc">ResourceBase</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="n">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'Hello World'</span><span class="p">];</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">ResourceResponse</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="create-a-node-programmatically">Create a node programmatically</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\node\Entity\Node</span><span class="p">;</span>

<span class="nv">$node</span> <span class="o">=</span> <span class="nc">Node</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
  <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'article'</span><span class="p">,</span>
  <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'Programmatically created node'</span><span class="p">,</span>
  <span class="s1">'body'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'value'</span> <span class="o">=&gt;</span> <span class="s1">'This node was created using code.'</span><span class="p">,</span>
    <span class="s1">'format'</span> <span class="o">=&gt;</span> <span class="s1">'basic_html'</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">]);</span>
<span class="nv">$node</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</code></pre></div></div>

<hr />

<h2 id="add-a-custom-field-programmatically">Add a custom field programmatically</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Drupal\field\Entity\FieldStorageConfig</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Drupal\field\Entity\FieldConfig</span><span class="p">;</span>

<span class="c1">// Add field storage (field definition)</span>
<span class="nc">FieldStorageConfig</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
  <span class="s1">'field_name'</span> <span class="o">=&gt;</span> <span class="s1">'custom_field'</span><span class="p">,</span>
  <span class="s1">'entity_type'</span> <span class="o">=&gt;</span> <span class="s1">'node'</span><span class="p">,</span>
  <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'string'</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>

<span class="c1">// Attach field to content type</span>
<span class="nc">FieldConfig</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
  <span class="s1">'field_name'</span> <span class="o">=&gt;</span> <span class="s1">'custom_field'</span><span class="p">,</span>
  <span class="s1">'entity_type'</span> <span class="o">=&gt;</span> <span class="s1">'node'</span><span class="p">,</span>
  <span class="s1">'bundle'</span> <span class="o">=&gt;</span> <span class="s1">'article'</span><span class="p">,</span>
  <span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Custom Field'</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</code></pre></div></div>

<hr />

  </div>

  <script>
    function updateThemeIcon() {
      const isDark = document.documentElement.classList.contains('dark');
      document.getElementById('icon-sun').style.display = isDark ? 'inline' : 'none';
      document.getElementById('icon-moon').style.display = isDark ? 'none' : 'inline';
    }
    function toggleDark() {
      const html = document.documentElement;
      const isDark = html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateThemeIcon();
    }
    // Load saved preference on page load
    (function () {
      const saved = localStorage.getItem('theme');
      if (saved) {
        document.documentElement.classList.toggle('dark', saved === 'dark');
      } else {
        // If no preference, fallback to system
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.classList.toggle('dark', prefersDark);
      }
      updateThemeIcon();
    })();
  </script>
</body>
</html>